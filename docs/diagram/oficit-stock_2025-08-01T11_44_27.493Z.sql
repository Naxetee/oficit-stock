CREATE TABLE "Componente" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(255) NOT NULL UNIQUE,
	"descripcion" TEXT,
	"id_proveedor" INTEGER,
	"id_color" INTEGER,
	PRIMARY KEY("id")
);




CREATE TABLE "Proveedor" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(127) NOT NULL UNIQUE,
	"telefono" VARCHAR(31),
	"email" VARCHAR(127),
	"direccion" VARCHAR(255),
	"activo" BOOLEAN DEFAULT False,
	PRIMARY KEY("id")
);




CREATE TABLE "Color" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(31) NOT NULL UNIQUE,
	"hex" VARCHAR(7),
	"url_imagen" VARCHAR(511),
	"id_familia" INTEGER,
	PRIMARY KEY("id")
);




CREATE TABLE "Familia" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(127) NOT NULL UNIQUE,
	"descripcion" TEXT,
	PRIMARY KEY("id")
);




CREATE TABLE "Articulo" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"nombre" VARCHAR(255),
	"descripcion" TEXT,
	"codigo_tienda" VARCHAR(31) UNIQUE,
	"id_familia" INTEGER,
	"activo" BOOLEAN DEFAULT False,
	"tipo" VARCHAR(255) NOT NULL CHECK(tipo IS NULL OR tipo IN ('simple', 'compuesto', 'pack')),
	PRIMARY KEY("id")
);




CREATE TABLE "Producto_Simple" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"id_proveedor" INTEGER,
	"id_color" INTEGER,
	PRIMARY KEY("id")
) INHERITS ("Producto");




CREATE TABLE "Producto_Compuesto" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	PRIMARY KEY("id")
) INHERITS ("Producto");




CREATE TABLE "Composicion_Prod.Compuesto" (
	"id_producto_compuesto" INTEGER,
	"id_componente" INTEGER,
	"cantidad" INTEGER,
	PRIMARY KEY("id_producto_compuesto", "id_componente")
) INHERITS ("Pack");




CREATE TABLE "Pack" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	PRIMARY KEY("id")
) INHERITS ("Articulo");




CREATE TABLE "Composicion_Pack" (
	"id_pack" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"id_producto" INTEGER NOT NULL,
	"cantidad" INTEGER NOT NULL DEFAULT 0,
	PRIMARY KEY("id_pack", "id_producto")
);




CREATE TABLE "Producto" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	PRIMARY KEY("id")
) INHERITS ("Articulo");



ALTER TABLE "Familia"
ADD FOREIGN KEY("id") REFERENCES "Color"("id_familia")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Proveedor"
ADD FOREIGN KEY("id") REFERENCES "Componente"("id_proveedor")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Familia"
ADD FOREIGN KEY("id") REFERENCES "Articulo"("id_familia")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Proveedor"
ADD FOREIGN KEY("id") REFERENCES "Producto_Simple"("id_proveedor")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Composicion_Prod.Compuesto"
ADD FOREIGN KEY("id_producto_compuesto") REFERENCES "Producto_Compuesto"("id")
ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE "Componente"
ADD FOREIGN KEY("id") REFERENCES "Composicion_Prod.Compuesto"("id_componente")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Pack"
ADD FOREIGN KEY("id") REFERENCES "Composicion_Pack"("id_pack")
ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE "Producto"
ADD FOREIGN KEY("id") REFERENCES "Composicion_Pack"("id_producto")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Color"
ADD FOREIGN KEY("id") REFERENCES "Componente"("id_color")
ON UPDATE CASCADE ON DELETE RESTRICT;
ALTER TABLE "Color"
ADD FOREIGN KEY("id") REFERENCES "Producto_Simple"("id_color")
ON UPDATE CASCADE ON DELETE RESTRICT;